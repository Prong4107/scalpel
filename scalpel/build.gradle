plugins {
    id 'java'

    // Bundle JEP in .jar
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}

group 'lexfo'
version '0.0.1'

repositories {
    mavenLocal()
    mavenCentral()
}

def venvPath = '../.venv'


def jepDir = file(venvPath + '/lib/').listFiles()
    .find { it.name.startsWith('python3') }
    .listFiles().find { it.name.matches('site-packages') }
    .listFiles().find { it.name.matches('jep') }
    .getAbsolutePath()

def jepJar = fileTree(dir: venvPath + '/lib', include: '**/jep/jep-*.jar').files.first().getAbsolutePath()

dependencies {
    compileOnly 'net.portswigger.burp.extensions:montoya-api:2023.1'

    // JEP installed from pip in a venv.
    implementation files(jepJar)

    implementation 'commons-io:commons-io:2.6'
}

jar {
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

sourceSets {
    main {
        resources {
            srcDirs jepDir
        }
    }
}

tasks.withType(Copy).all { duplicatesStrategy 'exclude' }
