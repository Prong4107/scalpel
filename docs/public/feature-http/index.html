<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="icon" type="image/png" href="../favicon.ico">
    <title>Intercept and rewrite HTTP traffic</title>
    
    

    
    <link rel="stylesheet" href="../style.min.css">

    

    <meta name="generator" content="Hugo 0.92.2" />
</head>
<body>

<div class="columns container is-marginless">
    <div id="sidebar" class="column is-one-quarter">
        <div class="brand">
	<a href="https://www.lexfo.fr/en/">
		<img src='../logo-docs.png' alt="scalpel docs" />
	</a>
</div>

<nav class="menu">
	<p class="menu-label">Overview</p>
	<ul class="menu-list">
    
    
    
    
        <li>
            <a class=""
               href="../">Introduction</a>
            
        </li>
    
        <li>
            <a class=""
               href="../overview-installation/">Installation</a>
            
        </li>
    
        <li>
            <a class=""
               href="../overview-usage/">Usage</a>
            
        </li>
    
        <li>
            <a class=""
               href="../overview-faq/">FAQ</a>
            
        </li>
    
</ul>


	<p class="menu-label">Features</p>
	<ul class="menu-list">
    
    
    
    
        <li>
            <a class="is-active"
               href="../feature-http/">Intercept and rewrite HTTP traffic</a>
            
        </li>
    
        <li>
            <a class=""
               href="../feature-editors/">Custom Burp editors</a>
            
        </li>
    
</ul>


	<p class="menu-label">Script Development</p>
	<ul class="menu-list">
    
    
    
    
        <li>
            <a class=""
               href="../api/events.html">Event Hooks &amp; API</a>
            
        </li>
    
        <li>
            <a class=""
               href="../addons-java/">Accessing the Burp API</a>
            
        </li>
    
        <li>
            <a class=""
               href="../addons-examples/">Examples</a>
            
        </li>
    
</ul>


	<p class="menu-label">Tutorials</p>
	<ul class="menu-list">
    
    
    
    
        <li>
            <a class=""
               href="../tute-aes/">Decrypting custom encryption</a>
            
        </li>
    
</ul>


	<p class="menu-label">Core concepts</p>
	<ul class="menu-list">
    
    
    
    
        <li>
            <a class=""
               href="../concepts-howscalpelworks/">How scalpel works</a>
            
        </li>
    
</ul>


	<p class="menu-label">Technical documentation</p>
	<ul class="menu-list">
		<li>
			<a class="" href="../pdoc/">Python library</a>
		</li>

		<li>
			<a class="" href="../javadoc/">Java extension</a>
		</li>
		<li>
			<a class="" href="https://github.com/Prong4107/scalpel">
				<img src='../github.svg' alt="github" style="height: 16px; vertical-align: middle; margin-right: 5px;" /> Github
			</a>
		</li>
	</ul>
</nav>

    </div>
    <div id="main" class="column content">
        
        
<a class="button is-small is-outlined is-link is-pulled-right"
   target="_blank"
   href="https://github.com/Prong4107/scalpel/tree/docs/readme/docs/src/content/feature-http.md"
>

    Edit on GitHub
</a>


        <h1 id="intercept-and-rewrite-http-traffic"><a class="anchor" href="#intercept-and-rewrite-http-traffic">#&nbsp;&nbsp;</a>Intercept and Rewrite HTTP Traffic</h1>
<h4 id="request--response"><a class="anchor" href="#request--response">#&nbsp;&nbsp;</a>Request / Response</h4>
<p>To intercept requests/responses, implement the <a href="../api/events.html#request"><code>request()</code></a> and <a href="../api/events.html#response"><code>response()</code></a> functions in your script:</p>
<p><em>E.g: Hooks that add an arbitrary header to every request and response:</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pyscalpel</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="c1"># Intercept the request</span>
<span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Request</span><span class="p">:</span>
    <span class="c1"># Add an header</span>
    <span class="n">req</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&#34;X-Python-Intercept-Request&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;request&#34;</span>
    <span class="c1"># Return the modified request</span>
    <span class="k">return</span> <span class="n">req</span>

<span class="c1"># Same for response</span>
<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">res</span><span class="p">:</span> <span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&#34;X-Python-Intercept-Response&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;response&#34;</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div><br>
<h4 id="match"><a class="anchor" href="#match">#&nbsp;&nbsp;</a>Match</h4>
<p>Decide whether to intercept an HTTP message with the <a href="../api/events.html#match"><code>match()</code></a> function:</p>
<p><em>E.g: A match intercepting requests to <code>localhost</code> and <code>127.0.0.1</code> only:</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pyscalpel.http</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">flow</span><span class="p">:</span> <span class="n">Flow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># True if host is localhost or 127.0.0.1</span>
    <span class="k">return</span> <span class="n">flow</span><span class="o">.</span><span class="n">host_is</span><span class="p">(</span><span class="s2">&#34;localhost&#34;</span><span class="p">,</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">)</span>
</code></pre></div><h2 id="further-reading"><a class="anchor" href="#further-reading">#&nbsp;&nbsp;</a>Further reading</h2>
<p>Learn more about the available hooks in the technical documentation&rsquo;s <a href="../api/events.html">Event Hooks &amp; API</a> section.</p>


    </div>
</div>
</body>
</html>

